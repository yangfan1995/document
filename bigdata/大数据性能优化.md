# 大数据性能优化*

1. 良好的模型设计
2. 解决数据倾斜问题。
3.  减少 job 数。
4.  设置合理的 map reduce 的 task 数，能有效提升性能。 比如， 10w+ 级别的计算，用
   160 个 reduce （那是相当的浪费，1 个足够） 。
5.  了解数据分布，自己动手解决数据倾斜问题是个不错的选择。 set hive.groupby.skewindata=tr ue; 这是通用的算法优化，但算法优化有时不能适应特定业务背景，开发人员了解业务，了解数据，可以通过业务逻辑精确有效的解决数据倾斜问题。
6. 数据量较大的情况下，慎用 count(distinct) count(distinct) 容易产生倾斜问题。
7. 对小文件进行合并，是行至有效的提高调度效率的方法，假如所有的作业设置合理
   的文件数，对云梯的整体调度效率也会产生积极的正向影响。
8. 优化时把握整体，单个作业最优不如整体最优。

## Hive优化

### 表分区优化

##### 优化场景

针对某些数据表，为了调高检索速度进行Hive表分区处理。

##### 优化条件

1. 查询维度、业务需求
2. 日期分区
3. 类型分区

 ##### 优化原理

 将列值作为目录来存放数据，就是一个分区。这样查询时使用分区列进行过滤，只需根据列值直接扫描对应目录下的数据，不扫描其他不关心的分区，快速定位，提高查询效率。 

##### 优化结果

1. 分区查询和未分区查询

   ```sql
   select * from app_da_veh_log where dt='20190611' and rece_time='20190611082341';
   ```

   ![1571197873734](E:\document\img\性能优化\1571197825528.png)

   ```sql
   select * from app_da_veh_log where rece_time='20190611082341';
   ```

   ![1571197926347](E:\document\img\性能优化\1571197926347.png)

##### 注意事项

1. 分区字段是否太过紧凑，Hive以文件夹分区，太过紧凑会导致文件夹数量过多影响性能。
2. 尽量不要使用动态分区，动态分区时，每个分区一个reducer，分区过多reducer过多，对服务器压力过大。

### 压缩优化

#### 原始日志压缩

#### MR中间输出LZO压缩

#### 中间表SEQUENCEFILE、RCFILE格式

### MapReduce阶段优化

#### Map阶段

#### Reduce阶段

#### Shuffle阶段

### JOB优化

#### 执行模式

#### JOIN算法

#### 数据倾斜

##### count distinct

##### common join

### SQL作业优化

#### 作业并行执行

#### MR迭代次数推测

#### 业务SQL优化


## Spark程序优化(Scala)
## SQL和Spark SQL优化

####  用insert into替换union all 



### SQL 执行流程

| 执行流程           | 主要操作                             |
| ------------------ | ------------------------------------ |
| TableScanOperator  | 扫描数据表                           |
| ReduceSinkOperator | 创建将发送到Reduce端的<key,reduce>对 |
| JoinOperator       | Join两份数据                         |
| SelectOperator     | 选择输出列                           |
| FileSinkOperator   | 建立结果数据，输出至文件             |
| FilterOperator     | 过滤输入数据                         |
| GroupByOperator    | Group By语句                         |
| MapJoinOperator    | /*+mapjoin(t)*/                      |
| LimitOperator      | Limit语句处理                        |
| UnionOperator      | Union语句处理                        |



## Yarn调度优化
## HDFS优化